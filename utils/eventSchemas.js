// utils/eventSchemas.js

// ‚úÖ –ì–û–¢–û–í

// üì¶ –ò–º–ø–æ—Ä—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
// CONFIG.schemas –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
import { CONFIG } from './config/index.js';

/**
 * ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–±—ã—Ç–∏—è –ø–æ —Å—Ö–µ–º–µ
 *
 * @param {string} eventName - –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: 'subscribe_command')
 * @param {object} payload - –û–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –ø–æ–ª—è –∫–æ–º–∞–Ω–¥—ã
 * @returns {{
 *   valid: boolean,
 *   missingFields?: string[]
 * }}
 *
 * üí° –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö Redis-–∫–æ–º–∞–Ω–¥, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è,
 *     —á—Ç–æ –≤ payload –µ—Å—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è —Å–æ–≥–ª–∞—Å–Ω–æ config.json ‚Üí schemas
 */
export function validateEvent(eventName, payload) {
  // üîç –ò—â–µ–º —Å—Ö–µ–º—É –ø–æ –∏–º–µ–Ω–∏ —Å–æ–±—ã—Ç–∏—è
  // (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ö–µ–º—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ ‚Äî –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∏–∂–Ω–µ–º—É)
  const schema = CONFIG.schemas?.[eventName];

  // ‚ö†Ô∏è –ï—Å–ª–∏ —Å—Ö–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ –æ—à–∏–±–∫–æ–π
  if (!schema) {
    return {
      valid: false,
      missingFields: [`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏—è "${eventName}"`]
    };
  }

  // üìã –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∏–∑ —Å—Ö–µ–º—ã
  const requiredFields = schema.fields || [];

  // üîé –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–∏–µ –ø–æ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ payload
  const missingFields = requiredFields.filter(field => !(field in payload));

  // ‚ùå –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø–æ–ª—è ‚Äî —Å—á–∏—Ç–∞–µ–º –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º
  if (missingFields.length > 0) {
    return {
      valid: false,
      missingFields
    };
  }

  // ‚úÖ –í—Å–µ –ø–æ–ª—è –Ω–∞ –º–µ—Å—Ç–µ ‚Äî —É—Å–ø–µ—Ö
  return { valid: true };
}
